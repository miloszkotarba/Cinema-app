import{E as V}from"./EmptyTop-cOPrCTTz.js";import{r as n,j as F,o as Z,a as c,c as u,g as S,b as t,t as _,l as H,F as b,e as R,y as w,n as L}from"./index-elwunUWg.js";import{_ as P,a as Q}from"./seat_booked-08-YSVqh.js";import{_ as U,a as z}from"./AlertDisplay-ZM8wSD_9.js";import{a as W}from"./axios-QLjAsgXu.js";import{h as k}from"./ErrorHandler-0YoZ9Z16.js";import{p as Y}from"./parseISO-Xhmvrwg8.js";import{f as q}from"./format-G25Q7tmF.js";import{p as G}from"./pl-j07-MAlc.js";/* empty css                                                     */const J={class:"booking-box-top"},K={class:"container"},X={class:"info-wrapper"},x={class:"left"},I={style:{display:"block","font-weight":"300","font-size":"1.5rem"}},ee={class:"title"},te={class:"right"},se={style:{"font-size":"2rem","font-weight":"300"}},ae={class:"wrapper"},oe={class:"ticket-wrapper"},le={class:"container"},ne={key:0,class:"load"},ie=t("div",{class:"one"},null,-1),re=t("div",{class:"two"},null,-1),ce=t("div",{class:"three"},null,-1),ue=[ie,re,ce],ve={key:1,style:{"padding-top":"2.5rem"}},de={class:"seats-box"},_e=t("div",{class:"screen"},null,-1),me={class:"seat-row-number"},pe=["onClick"],he={class:"seat-number"},fe={key:0,src:P,alt:"Seat img"},ye={key:1,src:Q,alt:"Seat img"},ge={class:"seat-row-number"},ke=t("button",{class:"btn-action",type:"submit"},"ZATWIERDŹ ZMIANY >",-1),Se={__name:"ReservationEditSeats",setup(M){const y=n(!0),h=n(null),o=n(null),v=n(null),g=n(1),i=n(10),f=n([]),r=n([]),m=n(0),d=n(0),$="https://api.kino-screenix.pl/api/v1/screenings/",D=F();function A(s){const a=Y(s),e=q(a,"EEEE dd/MM/yyyy, HH:mm",{locale:G});return e.charAt(0).toUpperCase()+e.slice(1)}const C=async()=>{try{o.value=w.getters.getScreeningData,v.value=w.getters.getReservationData,(!o.value||!v.value)&&await D.push({path:"/repertuar"}),g.value=o.value.room.numberOfSeats,await T()}catch(s){k(s,h)}finally{O(),y.value=!1}},p=n(null),T=async()=>{try{const s=o.value.reservations;p.value=v.value.seats.map(a=>a.seatNumber),s&&(f.value=s.flatMap(a=>{const{seats:e}=a;return e?e.map(l=>l.seatNumber):[]}).sort((a,e)=>a-e).filter(a=>!p.value.includes(a)))}catch(s){k(s,h)}},j=s=>{let a=v.value.seats.map(e=>e.seatNumber);m.value=a.length,!f.value.includes(s)&&(r.value.includes(s)?r.value=r.value.filter(e=>e!==s):d.value<m.value&&(r.value=[...r.value,s]),d.value=r.value.length)},B=async()=>{if(m.value=p.value.length,d.value===void 0){z.addAlert("Musisz dokonać zmiany.","error");return}if(d.value!==m.value){z.addAlert(`Zaznaczono za mało miejsc. Wybrano ${d.value}/${m.value}.`,"error");return}let s=v.value.seats,a=r.value;s=s.map((l,E)=>(l.seatNumber=a[E],l)),await N({seats:s})},N=async s=>{try{const a=o.value._id,e=v.value._id;await W.patch($+`${a}/reservations/${e}`,s),await D.push({path:"/rezerwacja/podsumowanie"})}catch(a){k(a,h)}},O=()=>{r.value=p.value,d.value=p.length};return Z(C),(s,a)=>(c(),u("main",null,[S(U),t("div",J,[t("div",K,[t("div",X,[t("div",x,[t("span",I,_(o.value&&A(o.value.date)),1),t("span",ee,_(o.value&&o.value.movie?o.value.movie.title:"")+"/2D",1)]),t("div",te,[t("span",se,"Sala: "+_(o.value&&o.value.room?o.value.room.name:""),1)])])])]),t("div",ae,[t("div",oe,[t("div",le,[y.value?(c(),u("div",ne,ue)):(c(),u("div",ve,[t("form",{onSubmit:a[0]||(a[0]=H(e=>B(),["prevent"]))},[t("div",de,[_e,(c(!0),u(b,null,R(Math.ceil(g.value/i.value),e=>(c(),u("div",{key:e,class:"row"},[t("div",me,_(e),1),(c(!0),u(b,null,R(Math.min(i.value,g.value-(e-1)*i.value),l=>(c(),u("div",{key:l+(e-1)*i.value,class:L(["seat-container",{booked:f.value.includes(l+(e-1)*i.value),selected:r.value.includes(l+(e-1)*i.value)}]),onClick:E=>j(l+(e-1)*i.value)},[t("div",he,_(l+(e-1)*i.value),1),f.value.includes(l+(e-1)*i.value)||!r.value.includes(l+(e-1)*i.value)?(c(),u("img",fe)):(c(),u("img",ye))],10,pe))),128)),t("div",ge,_(e),1)]))),128))]),ke],32)]))])])])]))}},Te={__name:"ReservationEditSeatsView",setup(M){return(y,h)=>(c(),u(b,null,[S(V),S(Se)],64))}};export{Te as default};
