import{r,j,k as L,o as U,a as i,c as l,g as b,b as t,F as f,e as D,t as v,l as V,n as M}from"./index-elwunUWg.js";import{_ as Y,a as Z}from"./seat_booked-08-YSVqh.js";import{_ as H,a as J}from"./AlertDisplay-ZM8wSD_9.js";import{a as Q}from"./axios-QLjAsgXu.js";import{h as w}from"./ErrorHandler-0YoZ9Z16.js";import{p as q}from"./parseISO-Xhmvrwg8.js";import{f as G}from"./format-G25Q7tmF.js";import{p as K}from"./pl-j07-MAlc.js";import{E as X}from"./EmptyTop-cOPrCTTz.js";/* empty css                                                     */const x={class:"booking-box-top"},I={class:"container"},ee={id:"steps"},te=["data-desc"],se={class:"info-wrapper"},ae={class:"left"},oe={style:{display:"block","font-weight":"300","font-size":"1.5rem"}},ne={class:"title"},ie={class:"right"},le={style:{"font-size":"2rem","font-weight":"300"}},re={class:"wrapper"},ce={class:"ticket-wrapper"},ue={class:"container"},ve={key:0,class:"load"},de=t("div",{class:"one"},null,-1),_e=t("div",{class:"two"},null,-1),me=t("div",{class:"three"},null,-1),pe=[de,_e,me],he={key:1,style:{"padding-top":"2.5rem"}},fe={class:"seats-box"},ge=t("div",{class:"screen"},null,-1),ye={class:"seat-row-number"},Se=["onClick"],De={class:"seat-number"},be={key:0,src:Y,alt:"Seat img"},ke={key:1,src:Z,alt:"Seat img"},Ee={class:"seat-row-number"},Oe=t("button",{class:"btn-action",type:"submit"},"PODAJ DANE OSOBOWE >",-1),Ae={__name:"Seats",setup(R){const k=r([{number:1,description:"WYBIERZ BILETY",active:!1,done:!0},{number:2,description:"WYBIERZ MIEJSCA",active:!0,done:!1},{number:3,description:"DANE OSOBOWE",active:!0,done:!1},{number:3,description:"PŁATNOŚĆ",active:!0,done:!1},{number:4,description:"PODSUMOWANIE",active:!0,done:!1}]),g=r(null),E=j(),O=r(!0),$="https://api.kino-screenix.pl/api/v1/screenings";function z(a){const o=q(a),e=G(o,"EEEE dd/MM/yyyy, HH:mm",{locale:K});return e.charAt(0).toUpperCase()+e.slice(1)}const A=L("store"),s=r(null),y=r(7),c=r(10),C=async()=>{var a,o,e;try{if(s.value=A.getters.getFormData,(e=(o=(a=s.value)==null?void 0:a.screeningData)==null?void 0:o.room)!=null&&e.numberOfSeats&&(y.value=s.value.screeningData.room.numberOfSeats),!s.value){await E.push({path:"/repertuar"});return}await W()}catch(n){w(n,g)}finally{O.value=!1}},m=r([]),W=async()=>{var a,o,e,n;try{let _="";(o=(a=s.value)==null?void 0:a.screeningData)!=null&&o._id&&(_=(n=(e=s.value)==null?void 0:e.screeningData)==null?void 0:n._id);const N=await Q.get($+`/${_}/reservations`),{reservations:B}=N.data;B&&(m.value=B.flatMap(S=>{const{seats:h}=S;return h?h.map(P=>P.seatNumber):[]}).sort((S,h)=>S-h))}catch(_){w(_,g)}},u=r([]),p=r(0),d=r(0),T=a=>{var o,e;d.value=((o=s.value)==null?void 0:o.normalny)+((e=s.value)==null?void 0:e.ulgowy),!m.value.includes(a)&&(u.value.includes(a)?u.value=u.value.filter(n=>n!==a):p.value<d.value&&(u.value=[...u.value,a]),p.value=u.value.length)};r(null);const F=()=>{var a,o;if(d.value=((a=s.value)==null?void 0:a.normalny)+((o=s.value)==null?void 0:o.ulgowy),p.value!==d.value){J.addAlert(`Zaznaczono za mało miejsc. Wybrano ${p.value}/${d.value}.`,"error");return}A.dispatch("updateSelectedSeats",u.value),E.push({path:"/repertuar/dane"})};return U(()=>C()),(a,o)=>(i(),l("main",null,[b(H),t("div",x,[t("div",I,[t("div",ee,[(i(!0),l(f,null,D(k.value,(e,n)=>(i(),l("div",{key:n,class:M({step:!0,active:e.active,done:e.done}),"data-desc":e.description},v(e.number),11,te))),128))]),t("div",se,[t("div",ae,[t("span",oe,v(s.value&&z(s.value.screeningData.date)),1),t("span",ne,v(s.value&&s.value.screeningData?s.value.screeningData.movie.title:"")+"/2D",1)]),t("div",ie,[t("span",le,"Sala: "+v(s.value&&s.value.screeningData.room?s.value.screeningData.room.name:""),1)])])])]),t("div",re,[t("div",ce,[t("div",ue,[O.value?(i(),l("div",ve,pe)):(i(),l("div",he,[t("form",{onSubmit:o[0]||(o[0]=V(e=>F(),["prevent"]))},[t("div",fe,[ge,(i(!0),l(f,null,D(Math.ceil(y.value/c.value),e=>(i(),l("div",{key:e,class:"row"},[t("div",ye,v(e),1),(i(!0),l(f,null,D(Math.min(c.value,y.value-(e-1)*c.value),n=>(i(),l("div",{key:n+(e-1)*c.value,class:M(["seat-container",{booked:m.value.includes(n+(e-1)*c.value),selected:u.value.includes(n+(e-1)*c.value)}]),onClick:_=>T(n+(e-1)*c.value)},[t("div",De,v(n+(e-1)*c.value),1),m.value.includes(n+(e-1)*c.value)||!u.value.includes(n+(e-1)*c.value)?(i(),l("img",be)):(i(),l("img",ke))],10,Se))),128)),t("div",Ee,v(e),1)]))),128))]),Oe],32)]))])])])]))}},Ne={__name:"SeatsView",setup(R){return(k,g)=>(i(),l(f,null,[b(X),b(Ae)],64))}};export{Ne as default};
